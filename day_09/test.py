from day_09 import process


def test_small_example_2_knots() -> None:
    motion_series = """\
R 4
U 4
L 3
D 1
R 4
D 1
L 5
R 2
"""
    x_start = 0
    x_end = 5
    y_start = 0
    y_end = 4

    rb = process.RopeBridge(motion_series, knot_no=2, yield_intermt_steps=True)
    assert (
        rb.rope.to_grid(
            x_start,
            x_end,
            y_start,
            y_end,
            show_explicit_tail=True,
        )
        == """\
......
......
......
......
H....."""
    )

    rb_iter = iter(rb)

    exp_grids = [
        """\
......
......
......
......
TH....""",
        """\
......
......
......
......
sTH...""",
        """\
......
......
......
......
s.TH..""",
        """\
......
......
......
......
s..TH.""",
        """\
......
......
......
....H.
s..T..""",
        """\
......
......
....H.
....T.
s.....""",
        """\
......
....H.
....T.
......
s.....""",
        """\
....H.
....T.
......
......
s.....""",
        """\
...H..
....T.
......
......
s.....""",
        """\
..HT..
......
......
......
s.....""",
        """\
.HT...
......
......
......
s.....""",
        """\
..T...
.H....
......
......
s.....""",
        """\
..T...
..H...
......
......
s.....""",
        """\
..T...
...H..
......
......
s.....""",
        """\
......
...TH.
......
......
s.....""",
        """\
......
....TH
......
......
s.....""",
        """\
......
....T.
.....H
......
s.....""",
        """\
......
....T.
....H.
......
s.....""",
        """\
......
....T.
...H..
......
s.....""",
        """\
......
......
..HT..
......
s.....""",
        """\
......
......
.HT...
......
s.....""",
        """\
......
......
HT....
......
s.....""",
        """\
......
......
.H....
......
s.....""",
        """\
......
......
.TH...
......
s.....""",
    ]
    for grid in exp_grids:
        assert (
            next(rb_iter).to_grid(
                x_start,
                x_end,
                y_start,
                y_end,
                show_explicit_tail=True,
            )
            == grid
        )

    assert (
        rb.rope.tail_history_to_grid(x_start, x_end, y_start, y_end)
        == """\
..##..
...##.
.####.
....#.
s###.."""
    )

    assert len(rb.rope.tail_history) == 13


def test_small_example_10_knots() -> None:
    motion_series = """\
R 4
U 4
L 3
D 1
R 4
D 1
L 5
R 2
"""
    x_start = 0
    x_end = 5
    y_start = 0
    y_end = 4

    rb = process.RopeBridge(motion_series, knot_no=10, yield_intermt_steps=True)

    assert (
        rb.rope.to_grid(x_start, x_end, y_start, y_end)
        == """\
......
......
......
......
H....."""
    )

    rb_iter = iter(rb)

    exp_grids = [
        """\
......
......
......
......
1H....""",
        """\
......
......
......
......
21H...""",
        """\
......
......
......
......
321H..""",
        """\
......
......
......
......
4321H.""",
        """\
......
......
......
....H.
4321..""",
        """\
......
......
....H.
.4321.
5.....""",
        """\
......
....H.
....1.
.432..
5.....""",
        """\
....H.
....1.
..432.
.5....
6.....""",
        """\
...H..
....1.
..432.
.5....
6.....""",
        """\
..H1..
...2..
..43..
.5....
6.....""",
        """\
.H1...
...2..
..43..
.5....
6.....""",
        """\
..1...
.H.2..
..43..
.5....
6.....""",
        """\
..1...
..H2..
..43..
.5....
6.....""",
        """\
..1...
...H..
..43..
.5....
6.....""",
        """\
......
...1H.
..43..
.5....
6.....""",
        """\
......
...21H
..43..
.5....
6.....""",
        """\
......
...21.
..43.H
.5....
6.....""",
        """\
......
...21.
..43H.
.5....
6.....""",
        """\
......
...21.
..4H..
.5....
6.....""",
        """\
......
...2..
..H1..
.5....
6.....""",
        """\
......
...2..
.H13..
.5....
6.....""",
        """\
......
......
H123..
.5....
6.....""",
        """\
......
......
.H23..
.5....
6.....""",
        """\
......
......
.1H3..
.5....
6.....""",
    ]

    for grid in exp_grids:
        assert next(rb_iter).to_grid(x_start, x_end, y_start, y_end) == grid

    assert len(rb.rope.tail_history) == 1


def test_large_example_10_knots() -> None:
    motion_series = """\
R 5
U 8
L 8
D 3
R 17
D 10
L 25
U 20
"""
    x_start = -11
    x_end = 14
    y_start = -5
    y_end = 15

    rb = process.RopeBridge(motion_series, knot_no=10, yield_intermt_steps=False)

    assert (
        rb.rope.to_grid(x_start, x_end, y_start, y_end)
        == """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
...........H..............
..........................
..........................
..........................
..........................
.........................."""
    )

    rb_iter = iter(rb)

    exp_grids = [
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
...........54321H.........
..........................
..........................
..........................
..........................
..........................""",
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
................H.........
................1.........
................2.........
................3.........
...............54.........
..............6...........
.............7............
............8.............
...........9..............
..........................
..........................
..........................
..........................
..........................""",
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
........H1234.............
............5.............
............6.............
............7.............
............8.............
............9.............
..........................
..........................
...........s..............
..........................
..........................
..........................
..........................
..........................""",
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
.........2345.............
........1...6.............
........H...7.............
............8.............
............9.............
..........................
..........................
...........s..............
..........................
..........................
..........................
..........................
..........................""",
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
................987654321H
..........................
..........................
..........................
..........................
...........s..............
..........................
..........................
..........................
..........................
..........................""",
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
...........s.........98765
.........................4
.........................3
.........................2
.........................1
.........................H""",
        """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
...........s..............
..........................
..........................
..........................
..........................
H123456789................""",
        """\
H.........................
1.........................
2.........................
3.........................
4.........................
5.........................
6.........................
7.........................
8.........................
9.........................
..........................
..........................
..........................
..........................
..........................
...........s..............
..........................
..........................
..........................
..........................
..........................""",
    ]

    for grid in exp_grids:
        assert next(rb_iter).to_grid(x_start, x_end, y_start, y_end) == grid

    assert (
        rb.rope.tail_history_to_grid(x_start, x_end, y_start, y_end)
        == """\
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
..........................
#.........................
#.............###.........
#............#...#........
.#..........#.....#.......
..#..........#.....#......
...#........#.......#.....
....#......s.........#....
.....#..............#.....
......#............#......
.......#..........#.......
........#........#........
.........########........."""
    )

    assert len(rb.rope.tail_history) == 36
